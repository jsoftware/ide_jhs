<!DOCTYPE html>
<html><head></head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<style type="text/css">

#status{color:red;}

/* tablet */
@media screen and (max-device-width: 992px){
 *{font-size:24px;}
}

/* phone */
@media screen and (max-device-width: 640px){
 *{font-size:48px;}
}
</style>

<body onload="load()"><div><h2>JHS</h2>
<p>log in as user or log on as guest</p>
<hr/>  
<button type="button" id="login" onclick="login()">log in as user</button>
key: <input type="password" id="key" value="" size="12">
<hr/>
<div id='status'></div>
<hr/>
<button type="button" id="guest" onclick="logon()">log on as quest</button>
<p>
A guest session is a JHS front end to a J engine running as a linux user. It terminates when it hits the limit of <b>60</b> minutes or if it uses excessive resources (e.g. cpu or disk space).<br/><br/>

This is a good way to learn about J. Run some tutorials and experiment before you take the step of installing on your own machine. With J on your machine you can run the same JHS front end or have a choice of jconsole or Jqt.<br/><br/>

All files created during your session are deleted when the session ends. Use menu>file>jcopy to move files between the guest machine and your browser machine.<br/><br/>

Use jijx menu>jbreak to break out of a long running loop.
</p>
</div>

<script>
var rq;    
var busy= 0; // prevent new request until previous has completed

function load()
{
  document.title= 'jlogon'
  var input = byid("key");
  input.addEventListener("keyup", function(event) {
    if (event.keyCode === 13) {event.preventDefault(); byid("login").click();}
  });
  input.focus(); //! causes false click - kill in ajax with bad cookie - ugh
}

function ajaxrun(p)
{
 if(1==busy) {return;}
 busy= 1;
 rq= new XMLHttpRequest();
 rq.onreadystatechange= ajax;
 rq.open("POST","", true);
 rq.send(p);
}

function ajax()
{
  if(rq.readyState==4)
  {
    busy= 0;
    if("valid"==rq.responseText)
     setTimeout(gojijx,1000); // timeout to let server spin up
    else
    {
     byid('status').innerHTML= (idv('key')=='') ? 'all guest ports busy (try again later)' :'wrong key' ;
     idvs('key','');
     byid('key').focus();
    }
  }
}

function gojijx(){window.location.href= "jijx";}

function login(){
 key= idv('key');
 if(''==key) return; //! ignore false click from input.focus
 ajaxrun(encode("jserver-user?"+key));
}

function logon(){
 idvs('key','');
 ajaxrun(encode("jserver-guest?"));
}

function byid(id){return document.getElementById(id);}
function idv(id){return byid(id).value;}
function idvs(id,v){byid(id).value=v;}
function encode(d){return(encodeURIComponent(d)).replace("/%20/g","+");}
</script>
</body></html>
